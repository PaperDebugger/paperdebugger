syntax = "proto3";

package usage.v1;

import "google/api/annotations.proto";
import "google/protobuf/timestamp.proto";

option go_package = "paperdebugger/pkg/gen/api/usage/v1;usagev1";

service UsageService {
  rpc GetSessionUsage(GetSessionUsageRequest) returns (GetSessionUsageResponse) {
    option (google.api.http) = {get: "/_pd/api/v1/users/@self/usage/session"};
  }

  rpc GetWeeklyUsage(GetWeeklyUsageRequest) returns (GetWeeklyUsageResponse) {
    option (google.api.http) = {get: "/_pd/api/v1/users/@self/usage/weekly"};
  }
}

message SessionUsage {
  string id = 1;
  google.protobuf.Timestamp session_start = 2;
  google.protobuf.Timestamp session_expiry = 3;
  int64 prompt_tokens = 4;
  int64 completion_tokens = 5;
  int64 total_tokens = 6;
  int64 request_count = 7;
}

message WeeklyUsage {
  int64 prompt_tokens = 1;
  int64 completion_tokens = 2;
  int64 total_tokens = 3;
  int64 request_count = 4;
  int64 session_count = 5;
}

message GetSessionUsageRequest {}

message GetSessionUsageResponse {
  // Active session usage, null if no active session
  SessionUsage session = 1;
}

message GetWeeklyUsageRequest {}

message GetWeeklyUsageResponse {
  WeeklyUsage usage = 1;
}
